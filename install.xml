<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<name>Date Delivery</name>
	<version>1.00</version>
	<author>Max Borschev</author>
	<link>https://github.com/ZloyDeDD</link>
	<code>datedelivery</code>

    <!-- Проверяет наличие колонки date_delivery и добавляет ее в таблицу product если колонки нет -->
    <file path="admin/controller/catalog/product.php">

        <operation>
            <search><![CDATA[
                function index() {
            ]]></search>
            <add position="after"><![CDATA[
                //Date Delivery
                $check_date_delivery = $this->db->query("DESCRIBE " . DB_PREFIX . "product `date_delivery`");
                if ($check_date_delivery->num_rows == 0) {
                    $this->db->query("ALTER TABLE " . DB_PREFIX ."product ADD `date_delivery` date NOT NULL default '0000-00-00' COLLATE utf8_general_ci BEFORE `date_available`");
                }
                //Date Delivery END
            ]]></add>
        </operation>

        <operation>
            <search><![CDATA[
                if (isset($this->request->post['date_delivery'])) {
            ]]></search>
            <add position="before"><![CDATA[
                //Date Delivery
                if (isset($this->request->post['date_delivery'])) {
                    $data['date_delivery'] = $this->request->post['date_delivery'];
                } elseif (!empty($product_info)) {
                    $data['date_delivery'] = ($product_info['date_delivery'] != '0000-00-00') ? $product_info['date_delivery'] : '';
                } else {
                    $data['date_delivery'] = date('Y-m-d');
                }
                //Date Delivery END
            ]]></add>
        </operation>
    </file>

</modification>